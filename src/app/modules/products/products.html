<div class="products-page">
  <h1 class="title">
    {{ selectedCategory ? (selectedCategory | titlecase) : 'All Products' }}
  </h1>

  @if (searchTerm) {
    <p class="search-info">Search results for "{{ searchTerm }}"</p>
  }

  @if (selectedCategory) {
    <div class="filter-bar">
      <div class="product-count">
        <span class="count-number">{{ getTotalProductCount() }}</span>
        <span class="count-text">Products</span>
      </div>
      
      <div class="sort-container">
        <label for="sort-select">Sort by</label>
        <select id="sort-select" [(ngModel)]="sortBy" (change)="onSortChange($event)">
          <option value="default">Default</option>
          <option value="price-asc">Price: Low to High</option>
          <option value="price-desc">Price: High to Low</option>
          <option value="name-asc">Name: A - Z</option>
          <option value="name-desc">Name: Z - A</option>
        </select>
      </div>
    </div>
  }

  @if (displayedProducts.length > 0) {
    @for (subCategory of getSubCategories(); track subCategory) {
      <div class="subcategory-section">
        <h2 class="subcategory-title">{{ subCategory }}</h2>
        
        <div [class.products-scroll-container]="!(selectedCategory || searchTerm)" [class.products-grid-container]="(selectedCategory || searchTerm)">
          <div [class.products-scroll]="!(selectedCategory || searchTerm)" [class.products-grid]="(selectedCategory || searchTerm)">
            @for (p of groupedProducts[subCategory]; track p.id) {
              <div class="products-card">
                <div class="product-content" [routerLink]="['/product', p.id]">
                  <img [src]="p.image" [alt]="p.name" class="product-image">
                  <h3>{{ p.name }}</h3>
                  <p class="desc">{{ p.desc }}</p>
                  <p class="price">{{ p.price }} <img src="/riyals.png" alt="SAR" class="currency-icon"></p>
                </div>
                
                <button class="add-btn" (click)="add(p)" title="Add to Cart">
                  <i class="bi bi-plus"></i>
                </button>
              </div>
            }
          </div>
        </div>
      </div>
    }
  } @else {
    <div class="no-products">
      <i class="bi bi-inbox"></i>
      @if (searchTerm) {
        <p>No products found for "{{ searchTerm }}"</p>
      } @else {
        <p>No products found in this category</p>
      }
    </div>
  }
</div>
