<nav class="navbar" [class.scrolled]="isScrolled">

  <!-- Top Bar -->
  <div class="top-bar">
    <div class="logo">
      <a routerLink="/" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
        <i class="bi bi-lightning-charge-fill"></i>
        <span>PC Parts</span>
      </a>
    </div>

    <div class="top-actions">
      <!-- Language Toggle -->
      <button class="language-btn" (click)="toggleLanguage()" title="تغيير اللغة">
        <i class="bi bi-globe"></i>
        <span>{{ t('nav.language') }}</span>
      </button>

      <a routerLink="/cart" class="icon-btn cart-btn" [class.bounce]="cartBounce" [title]="t('nav.cart')">
        <i class="bi bi-cart-fill"></i>
        <span class="cart-badge" *ngIf="cartCount > 0">{{ cartCount }}</span>
      </a>

      <a routerLink="/login" class="icon-btn login-btn" [title]="t('nav.login')">
        <i class="bi bi-person-fill"></i>
      </a>

      <!-- Mobile Menu Toggle -->
      <button class="mobile-menu-btn" (click)="toggleMobileMenu()" title="Menu">
        <i class="bi bi-list"></i>
      </button>
    </div>
  </div>

  <!-- Second Bar - Categories & Search -->
  <div class="second-bar" [class.sticky]="isScrolled">
    <div class="categories-nav">
      <div class="category-item" 
           *ngFor="let category of categories()" 
           (mouseenter)="showDropdown(category.key)"
           (mouseleave)="startHideTimer()">
        <i class="category-icon" [ngClass]="category.icon" [style.color]="category.color"></i>
        <span class="category-name" (click)="navigateToCategory(category, $event)">{{ category.name }}</span>
        <i class="bi bi-chevron-down dropdown-arrow" 
           (click)="showDropdown(category.key); $event.stopPropagation()"></i>
        
        <!-- Dropdown -->
        <div class="category-dropdown" 
             *ngIf="activeDropdown === category.key"
             (mouseenter)="cancelHideTimer()"
             (mouseleave)="hideDropdownNow()">
          <a *ngFor="let item of category.items" 
             routerLink="/products" 
             [queryParams]="{category: item.key}" 
             class="dropdown-item"
             (click)="hideDropdownNow()">
            <i [ngClass]="item.icon" class="subcategory-icon"></i>
            {{ item.label }}
          </a>
        </div>
      </div>
    </div>

    <!-- Search in Second Bar -->
    <div class="search-container-second">
      <div class="search-box-second">
        <i class="bi bi-search search-icon"></i>
        <input 
          type="text" 
          [placeholder]="t('nav.search')"
          [(ngModel)]="searchText"
          (keyup.enter)="onSearch()"
        />
        <button (click)="onSearch()" *ngIf="searchText">
          <i class="bi bi-arrow-right-circle-fill"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Sidebar -->
  <div class="mobile-sidebar" [class.active]="showMobileSidebar" (click)="closeMobileMenu()">
    <div class="sidebar-content" (click)="$event.stopPropagation()">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <i class="bi bi-lightning-charge-fill"></i>
          <h3>PC Parts</h3>
        </div>
        <button class="close-sidebar" (click)="closeMobileMenu()">
          <i class="bi bi-x-lg"></i>
        </button>
      </div>
      
      <div class="sidebar-search">
        <i class="bi bi-search"></i>
        <input 
          type="text" 
          placeholder="Search for parts..."
          [(ngModel)]="searchText"
          (keyup.enter)="onSearchMobile()"
        />
        <button (click)="onSearchMobile()" *ngIf="searchText">
          <i class="bi bi-arrow-right-circle-fill"></i>
        </button>
      </div>

      <div class="sidebar-categories">
        <div class="sidebar-category" *ngFor="let category of categories()">
          <div class="sidebar-category-title">
            <div class="category-info" (click)="navigateToCategory(category); closeMobileMenu()">
              <i [ngClass]="category.icon" [style.color]="category.color"></i>
              <span>{{ category.name }}</span>
            </div>
            <i class="bi" 
               [class.bi-chevron-down]="expandedSidebarCategory !== category.key" 
               [class.bi-chevron-up]="expandedSidebarCategory === category.key"
               (click)="toggleSidebarCategory(category.key); $event.stopPropagation()"></i>
          </div>
          <div class="sidebar-category-items" *ngIf="expandedSidebarCategory === category.key">
            <a *ngFor="let item of category.items" 
               routerLink="/products" 
               [queryParams]="{category: item.key}" 
               class="sidebar-item"
               (click)="closeMobileMenu()">
              <i [ngClass]="item.icon" class="subcategory-icon"></i>
              {{ item.label }}
            </a>
          </div>
        </div>
      </div>

      <div class="sidebar-actions">
        <a routerLink="/cart" class="sidebar-action" (click)="closeMobileMenu()">
          <i class="bi bi-cart3"></i>
          <span>{{ t('nav.cart') }} ({{ cartCount }})</span>
          <span class="cart-indicator" *ngIf="cartCount > 0">{{ cartCount }}</span>
        </a>
        <a routerLink="/login" class="sidebar-action" (click)="closeMobileMenu()">
          <i class="bi bi-person-circle"></i>
          <span>{{ t('nav.login') }}</span>
        </a>
        <button class="sidebar-action" (click)="toggleLanguage()">
          <i class="bi bi-translate"></i>
          <span>{{ t('nav.language') === 'E' ? 'English' : 'العربية' }}</span>
        </button>
      </div>
    </div>
  </div>

</nav>
